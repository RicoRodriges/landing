(()=>{"use strict";var t={126:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){if(16!==(t=t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).length)throw new Error("Matrix is 4x4");this.data=new Float32Array(t)}multiply(t){const e=this.data[0],i=this.data[1],n=this.data[2],s=this.data[3],r=this.data[4],o=this.data[5],a=this.data[6],h=this.data[7],l=this.data[8],c=this.data[9],d=this.data[10],u=this.data[11],f=this.data[12],g=this.data[13],m=this.data[14],p=this.data[15],w=t.data[0],v=t.data[1],_=t.data[2],T=t.data[3],E=t.data[4],P=t.data[5],M=t.data[6],x=t.data[7],I=t.data[8],y=t.data[9],S=t.data[10],O=t.data[11],L=t.data[12],R=t.data[13],b=t.data[14],F=t.data[15];this.data[0]=w*e+v*r+_*l+T*f,this.data[1]=w*i+v*o+_*c+T*g,this.data[2]=w*n+v*a+_*d+T*m,this.data[3]=w*s+v*h+_*u+T*p,this.data[4]=E*e+P*r+M*l+x*f,this.data[5]=E*i+P*o+M*c+x*g,this.data[6]=E*n+P*a+M*d+x*m,this.data[7]=E*s+P*h+M*u+x*p,this.data[8]=I*e+y*r+S*l+O*f,this.data[9]=I*i+y*o+S*c+O*g,this.data[10]=I*n+y*a+S*d+O*m,this.data[11]=I*s+y*h+S*u+O*p,this.data[12]=L*e+R*r+b*l+F*f,this.data[13]=L*i+R*o+b*c+F*g,this.data[14]=L*n+R*a+b*d+F*m,this.data[15]=L*s+R*h+b*u+F*p}static Ortho(t,e,n,s,r,o){return new i([2/(e-t),0,0,0,0,2/(s-n),0,0,0,0,2/(r-o),0,(t+e)/(t-e),(n+s)/(n-s),(r+o)/(r-o),1])}static Perspective(t,e,n,s){const r=Math.tan(.5*Math.PI-.5*t),o=1/(n-s);return new i([r/e,0,0,0,0,r,0,0,0,0,(n+s)*o,-1,0,0,n*s*o*2,0])}static Translate(t,e,n){return new i([1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1])}static XRotate(t){const e=Math.cos(t),n=Math.sin(t);return new i([1,0,0,0,0,e,n,0,0,-n,e,0,0,0,0,1])}static YRotate(t){const e=Math.cos(t),n=Math.sin(t);return new i([e,0,-n,0,0,1,0,0,n,0,e,0,0,0,0,1])}static ZRotate(t){const e=Math.cos(t),n=Math.sin(t);return new i([e,n,0,0,-n,e,0,0,0,0,1,0,0,0,0,1])}static Scale(t,e,n){return new i([t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1])}static LookAt(t,e,n,s,r,o,a,h,l){let c=s-t,d=r-e,u=o-n;const f=1/Math.sqrt(c*c+d*d+u*u);c*=f,d*=f,u*=f;let g=d*l-u*h,m=u*a-c*l,p=c*h-d*a;const w=1/Math.sqrt(g*g+m*m+p*p);return g*=w,m*=w,p*=w,new i([g,m*u-p*d,-c,0,m,p*c-g*u,-d,0,p,g*d-m*c,-u,0,0,0,0,1]).translate(-t,-e,-n)}translate(t,e,n){return this.multiply(i.Translate(t,e,n)),this}xRotate(t){return this.multiply(i.XRotate(t)),this}yRotate(t){return this.multiply(i.YRotate(t)),this}zRotate(t){return this.multiply(i.ZRotate(t)),this}scale(t,e,n){return this.multiply(i.Scale(t,e,n)),this}lookAt(t,e,n,s,r,o,a,h,l){return this.multiply(i.LookAt(t,e,n,s,r,o,a,h,l)),this}}e.default=i},109:(t,e)=>{function i(t,e,i,n){for(let s=0;s<t.positions.length;s+=3)t.positions[s+0]+=e,t.positions[s+1]+=i,t.positions[s+2]+=n}var n;Object.defineProperty(e,"__esModule",{value:!0}),e.Pyramid=e.Triangle=e.Plane45deg=e.PlaneRotate=e.YZPlane=e.XZPlane=e.XYPlane=e.Cuboid=e.rotateZ180=e.translate=void 0,e.translate=i,e.rotateZ180=function(t){let e=-1e5,n=-1e5;for(let i=0;i<t.positions.length;i+=3){const s=t.positions[i+0],r=t.positions[i+1];e=Math.max(s,e),n=Math.max(r,n),t.positions[i+0]=-s,t.positions[i+1]=-r,3===t.normals.length?0===i&&(t.normals[0]*=-1,t.normals[1]*=-1):(t.normals[i+0]*=-1,t.normals[i+1]*=-1)}i(t,e,n,0)},e.Cuboid=function(t,e,i){return{positions:[0,0,0,t,0,0,t,0,i,0,0,i,t,0,0,t,0,i,t,e,0,t,e,i,0,e,0,t,e,0,t,e,i,0,e,i,0,0,0,0,0,i,0,e,0,0,e,i,0,0,i,t,0,i,t,e,i,0,e,i,0,0,0,t,0,0,t,e,0,0,e,0],normals:[0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1],indexes:[0,1,2,0,2,3,4,6,5,5,6,7,8,10,9,8,11,10,12,13,14,13,15,14,16,17,18,16,18,19,20,22,21,20,23,22]}},e.XYPlane=function(t,e){return{positions:[0,0,0,t,0,0,0,e,0,t,e,0],normals:[0,0,1],indexes:[0,1,2,2,1,3]}},e.XZPlane=function(t,e){return{positions:[0,0,0,t,0,0,0,0,e,t,0,e],normals:[0,-1,0],indexes:[0,1,2,2,1,3]}},e.YZPlane=function(t,e){return{positions:[0,0,0,0,0,e,0,t,0,0,t,e],normals:[-1,0,0],indexes:[0,1,2,2,1,3]}},function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(n=e.PlaneRotate||(e.PlaneRotate={})),e.Plane45deg=function(t,e,i,s,r){const o=s?0:i,a=r===n.Y?s?i:0:o,h=r===n.Y?o:s?i:0,l=.7071;return{positions:[0,0,o,t,0,a,0,e,h,t,e,r===n.Y?a:h],normals:[r===n.Y?l:0,r===n.Y?0:l,l],indexes:[0,1,2,2,1,3]}},e.Triangle=function(t,e,i,n,s,r,o,a,h){return{positions:[0,0,0,t,e,i,n,s,r],normals:[o,a,h],indexes:[0,1,2]}},e.Pyramid=function(t,e,i){const n=Math.atan(i/(t/2))+Math.PI/2,s=Math.cos(n),r=Math.sin(n),o=Math.atan(i/(e/2))+Math.PI/2,a=Math.cos(o),h=Math.sin(o);return{positions:[0,0,0,t,0,0,0,e,0,t,e,0,0,0,0,t/2,e/2,i,0,e,0,t,0,0,t,e,0,t/2,e/2,i,0,0,0,t,0,0,t/2,e/2,i,0,e,0,t/2,e/2,i,t,e,0],normals:[0,0,-1,0,0,-1,0,0,-1,0,0,-1,s,0,r,s,0,r,s,0,r,-s,0,r,-s,0,r,-s,0,r,0,a,h,0,a,h,0,a,h,0,-a,h,0,-a,h,0,-a,h],indexes:[0,1,2,2,1,3,4,5,6,7,8,9,10,11,12,13,14,15]}}},921:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});const n=i(300);e.default=class{constructor(t,e,i,s,r){if(this.attrs=new Map,this.uniforms=new Map,this.gl=t.getContext("webgl")||t.getContext("experimental-webgl"),!this.gl)throw new Error("WebGL is not supported!");this.prog=(0,n.createProgramFromScripts)(this.gl,e,i),s.forEach((t=>this.attrs.set(t,this.gl.getAttribLocation(this.prog,t)))),r.forEach((t=>this.uniforms.set(t,this.gl.getUniformLocation(this.prog,t))))}useProgram(){this.gl.useProgram(this.prog)}uniformMatrix(t,e){const i=this.uniforms.get(t);if(void 0===i)throw new Error(`Program has no ${t} uniform variables`);const n=e.length;if(4===n)this.gl.uniformMatrix2fv(i,!1,e);else if(9===n)this.gl.uniformMatrix3fv(i,!1,e);else{if(16!==n)throw new Error(`Matrix size ${n} is not supported`);this.gl.uniformMatrix4fv(i,!1,e)}}uniformVector(t,e,i,n,s){const r=this.uniforms.get(t);if(void 0===r)throw new Error(`Program has no ${t} uniform variables`);void 0!==s?this.gl.uniform4f(r,e,i,n,s):void 0!==n?this.gl.uniform3f(r,e,i,n):void 0!==i?this.gl.uniform2f(r,e,i):this.gl.uniform1f(r,e)}arrayBuffer(t,e,i,n,s=!1){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),void 0!==n&&this.gl.bufferData(this.gl.ARRAY_BUFFER,n,s?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW),Object.entries(i).forEach((([t,i])=>{const n=this.attrs.get(t);if(void 0===n)throw new Error(`Program has no ${t} attribute variables`);this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,i.elems,i.elType,i.normalized,e,i.offsetBytes)}))}indexBuffer(t,e,i=!1){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t),void 0!==e&&this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e,i?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW)}drawElements(t,e,i,n=0){this.gl.drawElements(t,e,i,n)}drawArrays(t,e,i=0){this.gl.drawArrays(t,i,e)}createBuffer(){return this.gl.createBuffer()}get width(){return this.gl.canvas.clientWidth}get height(){return this.gl.canvas.clientHeight}}},300:(t,e)=>{function i(t,e,i){const s=t.createShader(e);if(s){if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;console.error(t.getShaderInfoLog(s)),n(t,s)}throw new Error("Shader couldn't be compiled")}function n(t,e){t.deleteShader(e)}function s(t,e,i){const n=t.createProgram();if(n){if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.error(t.getProgramInfoLog(n)),r(t,n)}throw new Error("Program couldn't be created")}function r(t,e){t.deleteProgram(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.resizeContext=e.deleteProgram=e.createProgramFromScripts=e.createProgram=e.deleteShader=e.createShader=void 0,e.createShader=i,e.deleteShader=n,e.createProgram=s,e.createProgramFromScripts=function(t,e,n){return s(t,i(t,t.VERTEX_SHADER,e),i(t,t.FRAGMENT_SHADER,n))},e.deleteProgram=r,e.resizeContext=function(t){const e=t.canvas,i=window.devicePixelRatio,n=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);e.width==n&&e.height==s||(e.width=n,e.height=s,t.viewport(0,0,n,s))}},674:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseMTL=void 0,e.parseMTL=function(t){const e=new Map;let i={};const n={newmtl(t,n){i={},e.set(n,i)},Ns(t){i.shininess=parseFloat(t[0])},Ka(t){i.ambient=t.map(parseFloat)},Kd(t){i.diffuse=t.map(parseFloat)},Ks(t){i.specular=t.map(parseFloat)},Ke(t){i.emissive=t.map(parseFloat)},Ni(t){i.opticalDensity=parseFloat(t[0])},d(t){i.opacity=parseFloat(t[0])},illum(t){i.illum=parseInt(t[0])}},s=/(\w+)\s+(.*)/;for(const e of t.split("\n").map((t=>t.trim()))){if(""===e||e.startsWith("#"))continue;const t=s.exec(e);if(!t)continue;const[,i,r]=t,o=e.split(/\s+/).slice(1),a=n[i];a?a(o,r):console.debug("unhandled keyword:",i)}return e}},391:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.positions=[[0,0,0]],this.texcoords=[[0,0]],this.normals=[[0,0,0]],this.geometries=[]}static parse(t){const e=new i;let n=null;function s(){if(n&&n.triangles.length){if(!n.name&&e.geometries.length>1){const t=e.geometries[e.geometries.length-2];n.name=t.name}n=null}}function r(){if(null===n){const t={triangles:[]};e.geometries.push(t),n=t}return n}function o(t){const e=t.split("/");if(2===e.length&&e.push("0"),3!==e.length)throw new Error(`Expected 3 vertex indexes like '1/1/1'. Found ${e.length} indexes: ${t}`);const i=e.map((t=>parseInt(t)));if(i.some((t=>isNaN(t))))throw new Error(`Vertex indexes '${t}' is not supported`);return i}const a={v(t){if(3!==t.length)throw new Error(`'v' command has ${t.length} coordinates. Expected 3`);e.positions.push(t.map((t=>parseFloat(t))))},vn(t){if(3!==t.length)throw new Error(`'vn' command has ${t.length} coordinates. Expected 3`);e.normals.push(t.map((t=>parseFloat(t))))},vt(t){if(t.length<2)throw new Error(`'vt' command has ${t.length} coordinates. Expected at least 2`);e.texcoords.push(t.map((t=>parseFloat(t))).slice(0,2))},f(t){const e=r(),i=t.length-2;for(let n=0;n<i;++n)e.triangles.push([o(t[0]),o(t[n+1]),o(t[n+2])])},s(){},mtllib(){},usemtl(t,e){s(),r().material=e},g(){s()},o(t,e){s(),r().name=e}},h=/(\w+)\s+(.*)/;for(const e of t.split("\n").map((t=>t.trim()))){if(""===e||e.startsWith("#"))continue;const t=h.exec(e);if(!t)continue;const[,i,n]=t,s=e.split(/\s+/).slice(1),r=a[i];r?r(s,n):console.debug("unhandled keyword:",i)}return e.geometries=e.geometries.filter((t=>t.triangles.length>0)),e}getPositionOf(t){return this.positions[t[0]]}getNormalOf(t){return this.normals[t[2]]}getSize(){const t={min:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],max:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]};for(const e of this.geometries)for(const i of e.triangles)for(const e of i){const i=this.getPositionOf(e);for(let e=0;e<3;++e)t.min[e]=Math.min(i[e],t.min[e]),t.max[e]=Math.max(i[e],t.max[e])}return t}getTriangleCount(){return this.geometries.reduce(((t,e)=>t+e.triangles.length),0)}}e.default=i},730:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.buf=new ArrayBuffer(t),this.view=new DataView(this.buf,0,t),this.size=0}clean(){this.size=0}reserveAndClean(t){t>this.buf.byteLength&&(this.buf=new ArrayBuffer(t),this.view=new DataView(this.buf,0,t)),this.clean()}get rawBuffer(){return this.buf}get bytes(){return this.size}slice(t,e,i){return e=e||0,i=i||Math.trunc((this.size-e)/t.BYTES_PER_ELEMENT),new t(this.buf,e,i)}}},146:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(i(730));class r extends s.default{constructor(t){super(t)}sliceFloat32(t,e){return this.slice(Float32Array,t,e)}sliceUint16(t,e){return this.slice(Uint16Array,t,e)}write4Uint8(t,e,i,n){this.view.setUint8(this.size,t),this.size+=1,this.view.setUint8(this.size,e),this.size+=1,this.view.setUint8(this.size,i),this.size+=1,this.view.setUint8(this.size,n),this.size+=1}write3Float32(t,e,i){this.view.setFloat32(this.size,t,!0),this.size+=4,this.view.setFloat32(this.size,e,!0),this.size+=4,this.view.setFloat32(this.size,i,!0),this.size+=4}write2Uint16(t,e){this.view.setUint16(this.size,t,!0),this.size+=2,this.view.setUint16(this.size,e,!0),this.size+=2}}e.default=r},333:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(i(730));class r extends s.default{constructor(t){super(t),this.lastIndex=-1}clean(){super.clean(),this.lastIndex=-1}sliceUint8(t,e){return this.slice(Uint8Array,t,e)}sliceUint16(t,e){return this.slice(Uint16Array,t,e)}write3Uint8(t,e,i){this.view.setUint8(this.size,t),this.size+=1,this.view.setUint8(this.size,e),this.size+=1,this.view.setUint8(this.size,i),this.size+=1,this.lastIndex=Math.max(this.lastIndex,t,e,i)}write3Uint16(t,e,i){this.view.setUint16(this.size,t,!0),this.size+=2,this.view.setUint16(this.size,e,!0),this.size+=2,this.view.setUint16(this.size,i,!0),this.size+=2,this.lastIndex=Math.max(this.lastIndex,t,e,i)}write2Uint16(t,e){this.view.setUint16(this.size,t,!0),this.size+=2,this.view.setUint16(this.size,e,!0),this.size+=2,this.lastIndex=Math.max(this.lastIndex,t,e)}write1Uint16(t){this.view.setUint16(this.size,t,!0),this.size+=2,this.lastIndex=Math.max(this.lastIndex,t)}get nextIndex(){return this.lastIndex+1}}e.default=r},607:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return s(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=o(i(522)),h=o(i(403)),l=o(i(770)),c=i(325),d=i(137),u=r(i(442));!function(){const t=document.getElementById("particles").querySelector("canvas"),e=()=>{t.width=window.innerWidth,t.height=window.innerHeight};e(),window.addEventListener("resize",e),new a.default(t,400,new h.default("public/mask.png"))}(),function(){const t=document.getElementById("town"),e=t.querySelector("canvas"),i=t.querySelector("button"),n=e=>{const i=t.querySelector(`input[name=${e}]`),n=t.querySelector(`input[name=${e}] ~ span`),s=()=>n.innerHTML=i.value;return s(),i.addEventListener("input",s),()=>parseInt(i.value)},s={width:n("width"),depth:n("depth"),height:n("height"),roads:n("roads"),population:n("population"),vegetation:n("vegetation")},r=()=>{e.width=window.innerWidth,e.height=window.innerHeight};r(),window.addEventListener("resize",r);let o=null;const a=()=>{null==o||o.detach(),o=new l.default(e,new c.Color(.7,.64,.62,1),s.width(),s.height(),s.depth(),s.roads(),s.population(),s.vegetation())};a(),i.addEventListener("click",a)}(),function(){const t="landscape";document.getElementById(t).querySelector("button").addEventListener("click",(()=>{switch((0,d.getState)(t)){case d.State.DAY:(0,d.setState)(t,d.State.NIGHT);break;case d.State.NIGHT:(0,d.setState)(t,d.State.DAY)}}))}(),function(){const t={mill:[{name:"",handler:new Map([["Mill",u.ProgType.POINTS],["propeller",u.ProgType.POINTS]])},{name:"Утвердить требования",handler:new Map([["Mill",u.ProgType.LINES],["propeller",u.ProgType.LINES]])},{name:"Разработать прототип",handler:new Map([["Mill",u.ProgType.SIMPLE_LIGHT],["propeller",u.ProgType.LINES]])},{name:"Разработать рабочий прототип",handler:new Map([["Mill",u.ProgType.SIMPLE_LIGHT],["propeller",u.ProgType.SIMPLE_LIGHT]])},{name:"Рефакторинг",handler:new Map([["Mill",u.ProgType.SPECULAR_LIGHT],["propeller",u.ProgType.SPECULAR_LIGHT]])}],grass:[{name:"Прояснить требования",handler:new Map([["Green_platform",u.ProgType.POINTS],["Island",u.ProgType.POINTS]])},{name:"Утвердить требования",handler:new Map([["Green_platform",u.ProgType.LINES],["Island",u.ProgType.LINES]])},{name:"Насыпать землю",handler:new Map([["Green_platform",u.ProgType.LINES],["Island",u.ProgType.SIMPLE_LIGHT]])},{name:"Посадить газон",handler:new Map([["Green_platform",u.ProgType.SIMPLE_LIGHT],["Island",u.ProgType.SIMPLE_LIGHT]])},{name:"Рефакторинг",handler:new Map([["Green_platform",u.ProgType.SPECULAR_LIGHT],["Island",u.ProgType.SPECULAR_LIGHT]])}],tree:[{name:"Прояснить требования",handler:new Map([["Tree",u.ProgType.POINTS],["N/A",u.ProgType.POINTS]])},{name:"Утвердить требования",handler:new Map([["Tree",u.ProgType.LINES],["N/A",u.ProgType.LINES]])},{name:"Поставить ствол",handler:new Map([["Tree",u.ProgType.SIMPLE_LIGHT],["N/A",u.ProgType.LINES]])},{name:"Наклеить листву",handler:new Map([["Tree",u.ProgType.SIMPLE_LIGHT],["N/A",u.ProgType.SIMPLE_LIGHT]])},{name:"Рефакторинг",handler:new Map([["Tree",u.ProgType.SPECULAR_LIGHT],["N/A",u.ProgType.SPECULAR_LIGHT]])}]},e=document.getElementById("obj"),i=e.querySelector("canvas"),n={};for(const i of Object.keys(t))n[i]={e:e.querySelector(`button[name=${i}]`),reset:e.querySelector(`button[name=${i}] ~ button`)};const s=()=>{i.width=window.innerWidth,i.height=window.innerHeight};s(),window.addEventListener("resize",s);const r=(0,u.loadObjFile)("public/low-poly-mill.obj"),o=(0,u.loadMtlFile)("public/low-poly-mill.mtl");Promise.all([r,o]).then((e=>{const s=new u.default(i,e[0],e[1],3.1,[0,0,0]);for(const[e,i]of Object.entries(n)){let n=0;const r=t[e],o=()=>{n=Math.min(n+1,r.length-1),i.e.innerHTML=r[Math.min(n+1,r.length-1)].name,r[n].handler.forEach(((t,e)=>s.setProperty(e,t)))},a=()=>{n=0,i.e.innerHTML=r[n+1].name,i.reset.innerHTML="Начать заново",r[n].handler.forEach(((t,e)=>s.setProperty(e,t)))};i.e.addEventListener("click",o),i.reset.addEventListener("click",a),a()}}))}()},137:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.setState=e.getState=e.State=void 0,function(t){t.DAY="day",t.NIGHT="night"}(i=e.State||(e.State={})),e.getState=function(t){return null!==document.querySelector(`#${t} .${i.DAY}`)?i.DAY:i.NIGHT},e.setState=function(t,e){const n=e===i.DAY?i.NIGHT:i.DAY,s=document.querySelector(`#${t} .${n}`);null!==s&&s.classList.replace(n,e)}},442:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ProgType=e.loadMtlFile=e.loadObjFile=void 0;const r=s(i(391)),o=i(674),a=s(i(921)),h=s(i(146)),l=s(i(333)),c=i(300),d=s(i(126));var u;e.loadObjFile=function(t){return n(this,void 0,void 0,(function*(){const e=yield fetch(t),i=yield e.text();return r.default.parse(i)}))},e.loadMtlFile=function(t){return n(this,void 0,void 0,(function*(){const e=yield fetch(t),i=yield e.text();return(0,o.parseMTL)(i)}))},function(t){t[t.DO_NOT_DRAW=0]="DO_NOT_DRAW",t[t.POINTS=1]="POINTS",t[t.LINES=2]="LINES",t[t.SIMPLE_LIGHT=3]="SIMPLE_LIGHT",t[t.SPECULAR_LIGHT=4]="SPECULAR_LIGHT"}(u=e.ProgType||(e.ProgType={})),e.default=class{constructor(t,e,i,n,s){this.progs=new Map,this.vertexBuffer=new h.default(1),this.indexBuffer=new l.default(1),this.cameraRotation=0,this.rotationSpeed=Math.PI/200,this.paused=!1,e.geometries.forEach((t=>t.name=t.name||"N/A")),this.el=t,this.obj=e,this.mtl=i,this.prop=new Map(this.obj.geometries.map((t=>[t.name,u.SIMPLE_LIGHT]))),this.background=[...s,1],this.objCoordRange=e.getSize(),this.initGLContext(),this.compilePrograms(n),this.fillBuffers(),this.drawNextFrame()}initGLContext(){const t=new a.default(this.el,"void main() { gl_Position = vec4(0, 0, 0, 0); }","void main() { gl_FragColor = vec4(0, 0, 0, 0); }",[],[]).gl;t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),this.glVertexBuffer=t.createBuffer(),this.glIndexBuffer=t.createBuffer()}compilePrograms(t){const e=`\n          attribute vec4 a_position;\n          attribute vec3 a_normal;\n        \n          uniform mat4 u_worldMatrix;\n          uniform mat4 u_worldProjectionMatrix;\n          uniform vec3 u_viewWorldPosition; // camera\n        \n          varying vec3 v_normal;\n          varying vec3 v_surfaceToView;\n        \n          void main() {\n            gl_Position = u_worldProjectionMatrix * a_position;\n            gl_PointSize = ${t};\n            v_normal = mat3(u_worldMatrix) * a_normal;\n            // vector vertex->camera\n            v_surfaceToView = u_viewWorldPosition - (u_worldMatrix * a_position).xyz;\n          }\n        `,i=["a_position","a_normal"],n=["u_worldMatrix","u_worldProjectionMatrix","u_lightDirection","u_viewWorldPosition","diffuse","ambient","u_ambientLight","emissive","specular","shininess","opacity"];{const t="\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                    precision highp float;\n                #else\n                    precision mediump float;\n                #endif\n                \n                varying vec3 v_normal;\n                varying vec3 v_surfaceToView;\n              \n                // material color\n                uniform vec3 diffuse;\n                // uniform sampler2D diffuseMap;\n                \n                // ambient light (sky, sun, ...)\n                uniform vec3 ambient;\n                uniform vec3 u_ambientLight;\n                \n                // light, which is generated by material\n                uniform vec3 emissive;\n                \n                // reflection light and its force\n                uniform vec3 specular;\n                // uniform sampler2D specularMap;\n                uniform float shininess; // 1 - strong, 2 - smooth\n                \n                uniform float opacity;\n                \n                uniform vec3 u_lightDirection;\n              \n                void main () {\n                  vec4 v_color = vec4(1, 1, 1, 1);\n                  vec3 normal = normalize(v_normal);\n              \n                  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n                  \n                  // vector between camera and light \n                  vec3 halfVector = normalize(u_lightDirection + surfaceToViewDirection);\n                  float specularLight = clamp(dot(normal, halfVector), 0.0, 1.0);\n                  //vec4 specularMapColor = texture2D(specularMap, v_texcoord);\n                  vec4 specularMapColor = vec4(1, 1, 1, 1);\n                  vec3 effectiveSpecular = specular * specularMapColor.rgb;\n              \n                  float fakeLight = dot(u_lightDirection, normal) * .25;\n                  //vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);\n                  vec4 diffuseMapColor = vec4(1, 1, 1, 1);\n                  vec3 effectiveDiffuse = diffuse * diffuseMapColor.rgb * v_color.rgb;\n                  float effectiveOpacity = opacity * diffuseMapColor.a * v_color.a;\n              \n                  gl_FragColor = vec4(\n                      emissive +\n                      ambient * u_ambientLight +\n                      effectiveDiffuse * fakeLight +\n                      effectiveSpecular * pow(specularLight, shininess),\n                      effectiveOpacity);\n                }\n            ";this.progs.set(u.SPECULAR_LIGHT,new a.default(this.el,e,t,i,n))}{const t="\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                    precision highp float;\n                #else\n                    precision mediump float;\n                #endif\n                \n                varying vec3 v_normal;\n                varying vec3 v_surfaceToView;\n              \n                uniform vec3 diffuse;\n                uniform vec3 ambient;\n                uniform vec3 u_ambientLight;\n                uniform vec3 emissive;\n                uniform vec3 specular;\n                uniform float shininess;\n                uniform float opacity;\n                uniform vec3 u_lightDirection;\n              \n                void main () {\n                  vec3 normal = normalize(v_normal);\n                  vec3 lightDirection = normalize(u_lightDirection);\n                  \n                  float light = dot(normal, lightDirection);\n                  \n                  gl_FragColor = vec4(normalize(diffuse) * light, 1);\n                }\n            ";this.progs.set(u.SIMPLE_LIGHT,new a.default(this.el,e,t,i,n))}{const t="\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                    precision highp float;\n                #else\n                    precision mediump float;\n                #endif\n                \n                varying vec3 v_normal;\n                varying vec3 v_surfaceToView;\n              \n                uniform vec3 diffuse;\n                uniform vec3 ambient;\n                uniform vec3 u_ambientLight;\n                uniform vec3 emissive;\n                uniform vec3 specular;\n                uniform float shininess;\n                uniform float opacity;\n                uniform vec3 u_lightDirection;\n              \n                void main () {\n                  gl_FragColor = vec4(normalize(diffuse), 1);\n                }\n            ";this.progs.set(u.LINES,new a.default(this.el,e,t,i,n))}{const t="\n                #ifdef GL_FRAGMENT_PRECISION_HIGH\n                    precision highp float;\n                #else\n                    precision mediump float;\n                #endif\n                \n                varying vec3 v_normal;\n                varying vec3 v_surfaceToView;\n              \n                uniform vec3 diffuse;\n                uniform vec3 ambient;\n                uniform vec3 u_ambientLight;\n                uniform vec3 emissive;\n                uniform vec3 specular;\n                uniform float shininess;\n                uniform float opacity;\n                uniform vec3 u_lightDirection;\n              \n                void main () {\n                  gl_FragColor = vec4(normalize(diffuse), 1);\n                }\n            ";this.progs.set(u.POINTS,new a.default(this.el,e,t,i,n))}}fillBuffers(){this.vertexBuffer.reserveAndClean(3*this.obj.getTriangleCount()*(6*Float32Array.BYTES_PER_ELEMENT)),this.indexBuffer.reserveAndClean(3*this.obj.getTriangleCount()*Uint16Array.BYTES_PER_ELEMENT);for(const t of this.obj.geometries)for(const e of t.triangles){const t=this.obj.getPositionOf(e[0]),i=this.obj.getPositionOf(e[1]),n=this.obj.getPositionOf(e[2]),s=[t[0]-i[0],t[1]-i[1],t[2]-i[2]],r=[t[0]-n[0],t[1]-n[1],t[2]-n[2]],o=[s[1]*r[2]-s[2]*r[1],-s[0]*r[2]+s[2]*r[0],s[0]*r[1]-s[1]*r[0]];for(const e of[t,i,n])this.vertexBuffer.write3Float32(...e),this.vertexBuffer.write3Float32(...o),this.indexBuffer.write1Uint16(this.indexBuffer.nextIndex)}const t=Float32Array.BYTES_PER_ELEMENT;for(const e of this.progs.values()){const i=e.gl;e.arrayBuffer(this.glVertexBuffer,6*t,{a_position:{elems:3,elType:i.FLOAT,normalized:!1,offsetBytes:0},a_normal:{elems:3,elType:i.FLOAT,normalized:!1,offsetBytes:3*t}},this.vertexBuffer.sliceFloat32()),e.indexBuffer(this.glIndexBuffer,this.indexBuffer.sliceUint16())}}drawNextFrame(){if(this.paused)return;window.requestAnimationFrame(this.drawNextFrame.bind(this));const t=this.progs.values().next().value.gl;(0,c.resizeContext)(t),t.clearColor(...this.background),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);{this.cameraRotation-=this.rotationSpeed,this.cameraRotation<2*-Math.PI&&(this.cameraRotation=0);const e=[0,0,0];for(let t=0;t<3;++t)e[t]=this.objCoordRange.min[t]+(this.objCoordRange.max[t]-this.objCoordRange.min[t])/2;const i=d.default.XRotate(Math.PI/6).yRotate(this.cameraRotation).translate(-e[0],-e[1],-e[2]),n=1.2*Math.sqrt(Math.pow(this.objCoordRange.max[0]-this.objCoordRange.min[0],2)+Math.pow(this.objCoordRange.max[1]-this.objCoordRange.min[1],2)+Math.pow(this.objCoordRange.max[2]-this.objCoordRange.min[2],2)),s=n/1e3,r=3*n,o=t.canvas.clientWidth/t.canvas.clientHeight,a=[0,0,n],h=d.default.Perspective(60*Math.PI/180,o,s,r);h.multiply(d.default.LookAt(a[0],a[1],a[2],0,0,0,0,1,0)),h.multiply(i);let l=0;for(const e of this.obj.geometries){const n=this.prop.get(e.name);if(void 0===n||n===u.DO_NOT_DRAW){l+=3*e.triangles.length;continue}const s=this.progs.get(n);s.useProgram(),s.uniformMatrix("u_worldMatrix",i.data),s.uniformMatrix("u_worldProjectionMatrix",h.data),s.uniformVector("u_lightDirection",1,3,5),s.uniformVector("u_viewWorldPosition",...a);const r=this.mtl.get(e.material||"");s.uniformVector("diffuse",...(null==r?void 0:r.diffuse)||[1,1,1]),s.uniformVector("ambient",...(null==r?void 0:r.ambient)||[0,0,0]),s.uniformVector("u_ambientLight",.1,.1,.1),s.uniformVector("emissive",...(null==r?void 0:r.emissive)||[0,0,0]),s.uniformVector("specular",...(null==r?void 0:r.specular)||[1,1,1]),s.uniformVector("shininess",(null==r?void 0:r.shininess)||400),s.uniformVector("opacity",(null==r?void 0:r.opacity)||1);const o=3*e.triangles.length,c=n===u.POINTS?t.POINTS:n===u.LINES?t.LINE_LOOP:t.TRIANGLES;s.drawElements(c,o,t.UNSIGNED_SHORT,l*Uint16Array.BYTES_PER_ELEMENT),l+=o}}}get objectNames(){return this.obj.geometries.map((t=>t.name))}setProperty(t,e){this.prop.set(t,e)}set active(t){this.paused=!t,this.paused||this.drawNextFrame()}}},403:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.mask=null,this.w=0,this.h=0,this.scaledW=0,this.scaledH=0,this.canvasW=0,this.canvasH=0,this.scale=1;const e=new Image;e.crossOrigin="anonymous",e.onload=this.onMaskLoaded.bind(this,e),e.src=t}updateScale(t,e){this.mask&&(this.canvasW=t,this.canvasH=e,this.scale=Math.min(t/this.w,e/this.h),this.scaledW=this.w*this.scale,this.scaledH=this.h*this.scale)}toMaskPixelCoordinate(t,e){let i=Math.abs(this.scaledW-this.canvasW)/2,n=Math.abs(this.scaledH-this.canvasH)/2;return i>n?n=0:i=0,[(t-i)/this.scale|0,(e-n)/this.scale|0]}isIntersect(t,e){return!this.mask||([t,e]=this.toMaskPixelCoordinate(t,e),this.read(t,e))}isConnected(t,e,i,n){if(!this.mask)return!0;if([t,e]=this.toMaskPixelCoordinate(t,e),[i,n]=this.toMaskPixelCoordinate(i,n),t===i){const i=Math.min(e,n),s=Math.max(e,n);for(let e=i;e<=s;++e)if(!this.read(t,e))return!1;return!0}const s=(e-n)/(t-i),r=e-t*s;if(Math.abs(s)>=1){const t=Math.min(e,n),i=Math.max(e,n);for(let e=t;e<=i;++e)if(!this.read((e-r)/s|0,e))return!1;return!0}{const e=Math.min(t,i),n=Math.max(t,i);for(let t=e;t<=n;++t)if(!this.read(t,s*t+r|0))return!1;return!0}}read(t,e){if(this.mask){if(t<this.w&&e<this.h&&t>=0&&e>=0){const i=this.w*e+t;return 0!==this.mask[i]}return!1}return!0}write(t,e,i){if(this.mask){const n=this.w*e+t;this.mask[n]=i?1:0}}onMaskLoaded(t){const e=document.createElement("canvas"),i=this.w=e.width=t.width,n=this.h=e.height=t.height,s=e.getContext("2d");s.drawImage(t,0,0);const r=s.getImageData(0,0,i,n),o=new Uint32Array(r.data.buffer);this.mask=new Int8Array(this.w*this.h);for(let t=0;t<n;++t)for(let e=0;e<i;++e){const i=(16777215&o[r.width*t+e])>0;this.write(e,t,i)}}}},299:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.x=Math.random()*t,this.y=Math.random()*e;const i=Math.random()*Math.PI*2;this.vx=2*Math.cos(i),this.vy=2*Math.sin(i)}update(t,e){this.x+=this.vx,this.y+=this.vy;let i=!0;this.x<0?this.x=0:this.x>t?this.x=t:i=!1,i&&(this.vx*=-1);let n=!0;this.y<0?this.y=0:this.y>e?this.y=e:n=!1,n&&(this.vy*=-1)}}},522:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(i(299)),r=i(300),o=n(i(921)),a=n(i(146)),h=n(i(333));e.default=class{constructor(t,e,i){this.vertexBuffer=new a.default(1),this.indexBuffer=new h.default(1),this.particles=[],this.springConst=25e-6,this.paused=!1,this.el=t,this.mask=i;const n=this.el.clientWidth,r=this.el.clientHeight;for(let t=0;t<e;++t)this.particles.push(new s.default(n,r));this.initGLContext(),this.drawNextFrame()}initGLContext(){this.lineProg=new o.default(this.el,"\n            attribute vec2 a_position;\n            \n            uniform vec2 u_resolution;\n\n            void main() {\n              // [0; +oo] -> [0; 1] -> [0; 2] -> [-1; 1]\n              vec2 clipSpace = a_position / u_resolution * 2.0 - 1.0;\n              gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n            }\n        ","\n            precision mediump float;\n            void main() {\n              gl_FragColor = vec4(0.75, 0.75, 0.75, 1); // #CCC\n            }\n        ",["a_position"],["u_resolution"]),this.pointProg=new o.default(this.el,"\n            attribute vec2 a_position;\n            \n            uniform vec2 u_resolution;\n            \n            varying vec2 v_pos;\n\n            void main() {\n              // [0; +oo] -> [0; 1] -> [0; 2] -> [-1; 1]\n              vec2 clipSpace = a_position / u_resolution * 2.0 - 1.0;\n              gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n              \n              gl_PointSize = 7.0;\n\n              v_pos = gl_Position.xy;\n            }\n        ","\n            precision mediump float;\n            \n            varying vec2 v_pos;\n\n            void main() {\n              if (abs(distance(v_pos, gl_FragCoord.xy)) < 10.0) {\n                discard;\n              }\n              \n              // [-1; 1] -> [0; 1] \n              gl_FragColor = vec4(v_pos * 0.5 + 0.5, 0.5, 1);\n            }\n        ",["a_position"],["u_resolution"]),this.glVertexBuffer=this.pointProg.createBuffer(),this.glIndexBuffer=this.pointProg.createBuffer()}drawNextFrame(){var t;if(this.paused)return;window.requestAnimationFrame(this.drawNextFrame.bind(this));const e=this.lineProg.gl;(0,r.resizeContext)(e);const i=this.lineProg.width,n=this.lineProg.height;null===(t=this.mask)||void 0===t||t.updateScale(i,n);const s=2*this.particles.length*Uint16Array.BYTES_PER_ELEMENT;this.vertexBuffer.reserveAndClean(s);const o=this.particles.length*this.particles.length*2*Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer.reserveAndClean(o),this.particles.forEach((t=>{t.update(i,n),this.vertexBuffer.write2Uint16(t.x,t.y)}));const a=10*i;for(let t=0;t<this.particles.length;++t){const e=this.particles[t];if(!this.mask||this.mask.isIntersect(e.x,e.y))for(let i=t+1;i<this.particles.length;++i){const n=this.particles[i];if(this.mask&&!this.mask.isIntersect(n.x,n.y))continue;const s=e.x-n.x,r=e.y-n.y;if(s*s+r*r<a){if(this.mask&&!this.mask.isConnected(e.x,e.y,n.x,n.y))continue;e.vx-=s*this.springConst,e.vy-=r*this.springConst,n.vx+=s*this.springConst,n.vy+=r*this.springConst,this.indexBuffer.write2Uint16(t,i)}}}e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),this.lineProg.useProgram(),this.lineProg.arrayBuffer(this.glVertexBuffer,2*Uint16Array.BYTES_PER_ELEMENT,{a_position:{elems:2,elType:e.UNSIGNED_SHORT,normalized:!1,offsetBytes:0}},this.vertexBuffer.sliceUint16()),this.lineProg.indexBuffer(this.glIndexBuffer,this.indexBuffer.sliceUint16()),this.lineProg.uniformVector("u_resolution",i,n),this.lineProg.drawElements(e.LINES,this.indexBuffer.bytes/2,e.UNSIGNED_SHORT),this.indexBuffer.clean();for(let t=0;t<this.particles.length;++t)this.indexBuffer.write1Uint16(t);this.pointProg.useProgram(),this.pointProg.arrayBuffer(this.glVertexBuffer,2*Uint16Array.BYTES_PER_ELEMENT,{a_position:{elems:2,elType:e.UNSIGNED_SHORT,normalized:!1,offsetBytes:0}}),this.pointProg.indexBuffer(this.glIndexBuffer,this.indexBuffer.sliceUint16()),this.pointProg.uniformVector("u_resolution",i,n),this.pointProg.drawElements(e.POINTS,this.indexBuffer.bytes/2,e.UNSIGNED_SHORT)}set active(t){this.paused=!t,this.paused||this.drawNextFrame()}}},770:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(300),r=i(325),o=n(i(126)),a=n(i(146)),h=n(i(333)),l=n(i(921));e.default=class{constructor(t,e,i,n,s,r,o,l){this.grid=[],this.gridSize=200,this.maxHeight=600,this.minHeight=100,this.vertexBuffer=new a.default(1),this.indexBuffer=new h.default(1),this.cameraRotation=0,this.rotationSpeed=Math.PI/1e3,this.paused=!1,this.el=t,this.bgColor=e,this.gridWidth=i,this.gridHeight=s,this.heightFactor=5/n,this.roads=r,this.population=Math.min(o/10,1),this.vegetation=Math.min(l/10,1),this.initGLContext(),this.generateGrid(),this.drawNextFrame()}initGLContext(){this.glProg=new l.default(this.el,"\n            attribute vec4 a_position;\n            attribute vec3 a_normal;\n            attribute vec4 a_color;\n\n            uniform mat4 u_worldMatrix;\n            uniform mat4 u_worldProjectionMatrix;\n\n            varying vec4 v_color;\n            varying vec3 v_normal;\n\n            void main() {\n              gl_Position = u_worldProjectionMatrix * a_position;\n              v_color = a_color;\n              v_normal = mat3(u_worldMatrix) * a_normal;\n            }\n        ","\n            #ifdef GL_FRAGMENT_PRECISION_HIGH\n                precision highp float;\n            #else\n                precision mediump float;\n            #endif\n            \n            uniform vec3 u_lightDirection;\n\n            varying vec4 v_color;\n            varying vec3 v_normal;\n\n            void main() {\n                vec3 normal = normalize(v_normal);\n                vec3 lightDirection = normalize(u_lightDirection);\n                \n                float light = dot(normal, -lightDirection);\n            \n                gl_FragColor = v_color;\n                gl_FragColor.rgb *= light;\n            }\n        ",["a_position","a_normal","a_color"],["u_worldMatrix","u_worldProjectionMatrix","u_lightDirection"]),this.glProg.gl.enable(this.glProg.gl.CULL_FACE),this.glProg.gl.cullFace(this.glProg.gl.BACK),this.glProg.gl.enable(this.glProg.gl.DEPTH_TEST),this.glVertexBuffer=this.glProg.createBuffer(),this.glIndexBuffer=this.glProg.createBuffer()}generateGrid(){this.grid=[];for(let t=0;t<this.gridWidth;++t){this.grid[t]=[];for(let e=0;e<this.gridHeight;++e)this.grid[t][e]=[],Math.random()<=this.population?this.grid[t][e].push(new r.House(this.gridSize,(0,r.calcHeight)(t,e,this.gridWidth,this.gridHeight,this.heightFactor,this.maxHeight,this.minHeight),r.PALLETS[Math.trunc(Math.random()*r.PALLETS.length)])):Math.random()<=this.vegetation&&this.grid[t][e].push(new r.Tree(this.gridSize))}const t=new Set,e=new Set;for(let e=0;e<this.roads;e+=2){const e=Math.trunc(Math.random()*this.gridWidth);for(let i=0;i<this.gridWidth;++i){const n=(e+i)%this.gridWidth;if(!(t.has(n)||t.has(n-1)||t.has(n+1))){t.add(n);break}}}for(let t=1;t<this.roads;t+=2){const t=Math.trunc(Math.random()*this.gridHeight);for(let i=0;i<this.gridHeight;++i){const n=(t+i)%this.gridHeight;if(!(e.has(n)||e.has(n-1)||e.has(n+1))){e.add(n);break}}}for(const t of e)for(let e=0;e<this.gridWidth;++e)this.grid[e][t]=[new r.Road(this.gridSize,r.RoadDirection.X)];for(const e of t)for(let t=0;t<this.gridHeight;++t)this.grid[e][t]=[new r.Road(this.gridSize,r.RoadDirection.Y)];for(const i of e)for(const e of t)this.grid[e][i]=[new r.Road(this.gridSize,r.RoadDirection.LINK)]}drawNextFrame(){if(this.paused)return;window.requestAnimationFrame(this.drawNextFrame.bind(this));let t=0;this.grid.forEach(((e,i)=>e.forEach(((e,i)=>e.forEach((e=>{e.frameUpdate(),t+=e.getTriangleCount()})))))),this.vertexBuffer.reserveAndClean(3*t*(3*Float32Array.BYTES_PER_ELEMENT+3*Float32Array.BYTES_PER_ELEMENT+4)),this.indexBuffer.reserveAndClean(3*t*Uint16Array.BYTES_PER_ELEMENT),this.grid.forEach(((t,e)=>t.forEach(((t,i)=>{const n=this.vertexBuffer.bytes;if(t.forEach((t=>{t.writeObject(this.vertexBuffer,this.indexBuffer)})),this.vertexBuffer.bytes>n){const t=this.vertexBuffer.sliceFloat32(n);for(let n=0;n<t.length;n+=7)t[n+0]+=this.gridSize*e,t[n+1]+=this.gridSize*i}}))));const e=this.glProg.gl;(0,s.resizeContext)(e),e.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.glProg.useProgram();const i=Float32Array.BYTES_PER_ELEMENT;this.glProg.arrayBuffer(this.glVertexBuffer,6*i+4,{a_position:{elems:3,elType:e.FLOAT,normalized:!1,offsetBytes:0},a_normal:{elems:3,elType:e.FLOAT,normalized:!1,offsetBytes:3*i},a_color:{elems:4,elType:e.UNSIGNED_BYTE,normalized:!0,offsetBytes:6*i}},this.vertexBuffer.sliceFloat32()),this.glProg.indexBuffer(this.glIndexBuffer,this.indexBuffer.sliceUint16());{this.cameraRotation-=this.rotationSpeed,this.cameraRotation<2*-Math.PI&&(this.cameraRotation=0);const t=this.gridWidth*this.gridSize/2,e=this.gridHeight*this.gridSize/2,i=Math.max(this.gridWidth,this.gridHeight)*this.gridSize,n=i/2,s=Math.sin(this.cameraRotation)*i+n,r=-Math.cos(this.cameraRotation)*i+n,a=n,h=o.default.LookAt(s,r,a,t,e,0,0,0,1),l=o.default.Ortho(-this.glProg.width,this.glProg.width,-this.glProg.height,this.glProg.height,-1e4,1e4);l.multiply(h),this.glProg.uniformMatrix("u_worldMatrix",h.data),this.glProg.uniformMatrix("u_worldProjectionMatrix",l.data),this.glProg.uniformVector("u_lightDirection",-.2,-.5,-1)}this.glProg.drawElements(e.TRIANGLES,this.indexBuffer.bytes/2,e.UNSIGNED_SHORT)}set active(t){this.paused=!t,this.paused||this.drawNextFrame()}detach(){this.paused=!0}}},325:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.calcHeight=e.PALLETS=e.Color=e.Road=e.RoadDirection=e.Tree=e.Antenna=e.Windows=e.Roof=e.House=e.DebugFloor=e.TownObject=void 0;const n=i(109);class s{frameUpdate(){}}var r,o;e.TownObject=s,e.DebugFloor=class extends s{constructor(t){super(),this.width=t,this.color=u.RandomColor()}getTriangleCount(){return 2}writeObject(t,e){f(t,e,(0,n.XYPlane)(this.width,this.width),this.color)}},e.House=class extends s{constructor(t,e,i){super(),this.height=e,this.color=i,this.width=t/(3*Math.random()+1),this.depth=t/(3*Math.random()+1),this.x=(t-this.width)/(5*Math.random()+1),this.y=(t-this.depth)/(5*Math.random()+1),this.roof=Math.random()>.33?new a(i,this.x,this.y,e,this.width,this.depth):void 0,this.windows=new h(i,this.x,this.y,this.width,this.height,this.depth),this.antenna=Math.random()<=.3?new l(this.x,this.y,this.height,this.width,this.depth):void 0}frameUpdate(){var t,e;super.frameUpdate(),null===(t=this.roof)||void 0===t||t.frameUpdate(),this.windows.frameUpdate(),null===(e=this.antenna)||void 0===e||e.frameUpdate()}getTriangleCount(){var t,e;return 12+((null===(t=this.roof)||void 0===t?void 0:t.getTriangleCount())||0)+this.windows.getTriangleCount()+((null===(e=this.antenna)||void 0===e?void 0:e.getTriangleCount())||0)}writeObject(t,e){var i,s;const r=(0,n.Cuboid)(this.width,this.depth,this.height);(0,n.translate)(r,this.x,this.y,0),f(t,e,r,this.color),null===(i=this.roof)||void 0===i||i.writeObject(t,e),this.windows.writeObject(t,e),null===(s=this.antenna)||void 0===s||s.writeObject(t,e)}},function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(r||(r={}));class a extends s{constructor(t,e,i,n,s,o){super(),this.houseColor=t,this.x=e,this.y=i,this.z=n,this.w=s,this.d=o,this.type=Math.random()<=.5?r.X:r.Y,this.roofColor=new u(70,70,70,t.a)}getTriangleCount(){return 6}writeObject(t,e){if(this.type===r.X){const i=(0,n.Plane45deg)(this.w,this.d/2,a.ROOF_HEIGHT,!0,n.PlaneRotate.X);(0,n.translate)(i,this.x,this.y,this.z),f(t,e,i,this.roofColor);const s=(0,n.Plane45deg)(this.w,this.d/2,a.ROOF_HEIGHT,!1,n.PlaneRotate.X);(0,n.translate)(s,this.x,this.y+this.d/2,this.z),f(t,e,s,this.roofColor);const r=(0,n.Triangle)(0,this.d/2,a.ROOF_HEIGHT,0,this.d,0,-1,0,0);(0,n.translate)(r,this.x,this.y,this.z),f(t,e,r,this.houseColor);const o=(0,n.Triangle)(0,this.d,0,0,this.d/2,a.ROOF_HEIGHT,1,0,0);(0,n.translate)(o,this.x+this.w,this.y,this.z),f(t,e,o,this.houseColor)}else if(this.type===r.Y){const i=(0,n.Plane45deg)(this.w/2,this.d,a.ROOF_HEIGHT,!0,n.PlaneRotate.Y);(0,n.translate)(i,this.x,this.y,this.z),f(t,e,i,this.roofColor);const s=(0,n.Plane45deg)(this.w/2,this.d,a.ROOF_HEIGHT,!1,n.PlaneRotate.Y);(0,n.translate)(s,this.x+this.w/2,this.y,this.z),f(t,e,s,this.roofColor);const r=(0,n.Triangle)(this.w,0,0,this.w/2,0,a.ROOF_HEIGHT,0,-1,0);(0,n.translate)(r,this.x,this.y,this.z),f(t,e,r,this.houseColor);const o=(0,n.Triangle)(this.w/2,0,a.ROOF_HEIGHT,this.w,0,0,0,1,0);(0,n.translate)(o,this.x,this.y+this.d,this.z),f(t,e,o,this.houseColor)}}}e.Roof=a,a.ROOF_HEIGHT=20;class h extends s{constructor(t,e,i,n,s,r){if(super(),this.color=t,this.x=e,this.y=i,this.width=n,this.height=s,this.depth=r,this.activeWindowsX=new Map,this.activeWindowsY=new Map,this.color=new u(this.color.r-10,this.color.g-10,this.color.b-10,this.color.a),this.windowsZ=Math.trunc(s/(h.windowHeight+2*h.offset)),this.windowsY=Math.trunc(r/(h.windowWidth+2*h.offset)),this.windowsX=Math.trunc(n/(h.windowWidth+2*h.offset)),this.windowsZ>0){if(this.windowsY>0)for(let t=0;t<h.activeWindowsOnOneWall;++t){const t=Math.trunc(Math.random()*this.windowsY),e=Math.trunc(Math.random()*this.windowsZ);this.activeWindowsY.set(1e3*e+t,{delayFrames:60*Math.random()*5+60,currentFrame:0,duration:60*Math.random()*2+60})}if(this.windowsX>0)for(let t=0;t<h.activeWindowsOnOneWall;++t){const t=Math.trunc(Math.random()*this.windowsX),e=Math.trunc(Math.random()*this.windowsZ);this.activeWindowsX.set(1e3*e+t,{delayFrames:60*Math.random()*5+60,currentFrame:0,duration:60*Math.random()*2+60})}}}getTriangleCount(){return 2*(this.windowsY+this.windowsX)*this.windowsZ*2}writeObject(t,e){const i=h.windowHeight+2*h.offset,s=(this.height-this.windowsZ*i)/2,r=h.windowWidth+2*h.offset,o=(this.depth-this.windowsY*r)/2,a=(this.width-this.windowsX*r)/2;{const a=this.x;for(let l=0;l<this.windowsZ;++l){const c=l*i+h.offset+s;for(let i=0;i<this.windowsY;++i){const s=i*r+h.offset+this.y+o,d=this.animInfo(void 0,i,l),u=d?h.calcColor(this.color,d):this.color,g=(0,n.YZPlane)(h.windowWidth,h.windowHeight);(0,n.translate)(g,a-1,s,c),f(t,e,g,u);const m=(0,n.YZPlane)(h.windowWidth,h.windowHeight);(0,n.rotateZ180)(m),(0,n.translate)(m,a+this.width+1,s,c),f(t,e,m,u)}}}{const o=this.y;for(let l=0;l<this.windowsZ;++l){const c=l*i+h.offset+s;for(let i=0;i<this.windowsX;++i){const s=i*r+h.offset+this.x+a,d=this.animInfo(i,void 0,l),u=d?h.calcColor(this.color,d):this.color,g=(0,n.XZPlane)(h.windowWidth,h.windowHeight);(0,n.translate)(g,s,o-1,c),f(t,e,g,u);const m=(0,n.XZPlane)(h.windowWidth,h.windowHeight);(0,n.rotateZ180)(m),(0,n.translate)(m,s,o+this.depth+1,c),f(t,e,m,u)}}}}animInfo(t,e,i){return void 0!==t?this.activeWindowsX.get(1e3*i+t):void 0!==e?this.activeWindowsY.get(1e3*i+e):void 0}frameUpdate(){super.frameUpdate(),this.activeWindowsX.forEach((t=>h.updateAnim(t))),this.activeWindowsY.forEach((t=>h.updateAnim(t)))}static updateAnim(t){t.currentFrame++,t.currentFrame>=t.delayFrames+t.duration+t.delayFrames+t.duration&&(t.currentFrame=0)}static calcColor(t,{delayFrames:e,currentFrame:i,duration:n}){if(i<=e)return t;if((i-=e)<=n){const e=170/n*i;return new u(t.r+e,t.g+e,t.b+e,t.a)}if((i-=n)<=e){const e=170;return new u(t.r+e,t.g+e,t.b+e,t.a)}if((i-=e)<=n){const e=170-170/n*i;return new u(t.r+e,t.g+e,t.b+e,t.a)}return t}}e.Windows=h,h.windowWidth=20,h.windowHeight=20,h.offset=5,h.activeWindowsOnOneWall=4;class l extends s{constructor(t,e,i,n,s){super(),this.z=i,this.color=new u(40,40,40,255);const r=Math.random();r<=.25?(this.x=t+l.OFFSET,this.y=e+l.OFFSET):r<=.5?(this.x=t+n-l.OFFSET,this.y=e+l.OFFSET):r<=.75?(this.x=t+l.OFFSET,this.y=e+s-l.OFFSET):(this.x=t+n-l.OFFSET,this.y=e+s-l.OFFSET),this.direction=Math.random()<.5,this.lines=Math.round(3*Math.random()+1)}getTriangleCount(){return 4*(this.lines+1)}writeObject(t,e){const i=this.x,s=this.y,r=this.direction?n.XZPlane:n.YZPlane,o=this.direction?l.WIDTH/2:0,a=this.direction?0:l.WIDTH/2,h=r(l.LINE_WIDTH,l.HEIGHT);(0,n.translate)(h,i,s,this.z),f(t,e,h,this.color);const c=r(l.LINE_WIDTH,l.HEIGHT);(0,n.rotateZ180)(c),(0,n.translate)(c,i,s,this.z),f(t,e,c,this.color);for(let h=0;h<this.lines;++h){const c=this.z+l.HEIGHT-l.HEIGHT/2/this.lines*(h+1),d=r(l.WIDTH,l.LINE_WIDTH);(0,n.translate)(d,i-o,s-a,c),f(t,e,d,this.color);const u=r(l.WIDTH,l.LINE_WIDTH);(0,n.rotateZ180)(u),(0,n.translate)(u,i-o,s-a,c),f(t,e,u,this.color)}}}e.Antenna=l,l.WIDTH=15,l.HEIGHT=35,l.LINE_WIDTH=2,l.OFFSET=6;class c extends s{constructor(t){super(),this.ROOT_COLOR=new u(112,94,88,255),this.LEAF_COLOR=new u(64,93,53,255),this.width=c.WIDTH+Math.trunc(40*Math.random()-20),this.height=c.HEIGHT+Math.trunc(80*Math.random()-40),this.x=(t-this.width)/(10*Math.random()+1),this.y=(t-this.width)/(10*Math.random()+1),this.leaf=Math.random()<.5?1:c.MAX_LEAF}getTriangleCount(){return 12+6*this.leaf}writeObject(t,e){const i=this.x,s=this.y,r=this.width,o=this.height,a=o/(c.MAX_LEAF+1),h=(0,n.Cuboid)(c.ROOT_WIDTH,c.ROOT_WIDTH,a);(0,n.translate)(h,i+r/2-c.ROOT_WIDTH/2,s+r/2-c.ROOT_WIDTH/2,0),f(t,e,h,this.ROOT_COLOR);const l=(o-a)/this.leaf;for(let h=1;h<=this.leaf;++h){const c=Math.min(r/h*1.7,r),d=o-a-l*(h-1),u=(0,n.Pyramid)(c,c,d);(0,n.translate)(u,i+(r-c)/2,s+(r-c)/2,o-d),f(t,e,u,this.LEAF_COLOR)}}}e.Tree=c,c.ROOT_WIDTH=5,c.WIDTH=60,c.HEIGHT=200,c.MAX_LEAF=3,function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.LINK=2]="LINK"}(o=e.RoadDirection||(e.RoadDirection={}));class d extends s{constructor(t,e){super(),this.gridSize=t,this.direction=e,this.BORDER_COLOR=new u(175,157,151,255),this.ROAD_COLOR=new u(163,145,139,255),this.LINE_COLOR=new u(255,255,255,255)}getTriangleCount(){return this.direction!=o.LINK?6+d.LINES:6}writeObject(t,e){if(this.direction===o.X){const i=d.OFFSET,s=(this.gridSize-2*i)/6,r=(0,n.XYPlane)(this.gridSize,this.gridSize-2*i-2*s);(0,n.translate)(r,0,i+s,0),f(t,e,r,this.ROAD_COLOR);const o=(0,n.XYPlane)(this.gridSize,s);(0,n.translate)(o,0,i,0),f(t,e,o,this.BORDER_COLOR),(0,n.translate)(o,0,-i+this.gridSize-i-s,0),f(t,e,o,this.BORDER_COLOR);const a=this.gridSize/(2*d.LINES),h=(0,n.Triangle)(a,2,0,0,4,0,0,0,1);(0,n.translate)(h,a/2,this.gridSize/2,1);for(let i=0;i<d.LINES;++i)f(t,e,h,this.LINE_COLOR),(0,n.translate)(h,2*a,0,0)}else if(this.direction===o.Y){const i=d.OFFSET,s=(this.gridSize-2*i)/6,r=(0,n.XYPlane)(this.gridSize-2*i-2*s,this.gridSize);(0,n.translate)(r,i+s,0,0),f(t,e,r,this.ROAD_COLOR);const o=(0,n.XYPlane)(s,this.gridSize);(0,n.translate)(o,i,0,0),f(t,e,o,this.BORDER_COLOR),(0,n.translate)(o,-i+this.gridSize-i-s,0,0),f(t,e,o,this.BORDER_COLOR);const a=this.gridSize/(2*d.LINES),h=(0,n.Triangle)(4,0,0,2,a,0,0,0,1);(0,n.translate)(h,this.gridSize/2,a/2,1);for(let i=0;i<d.LINES;++i)f(t,e,h,this.LINE_COLOR),(0,n.translate)(h,0,2*a,0)}else if(this.direction===o.LINK){f(t,e,(0,n.XYPlane)(this.gridSize,this.gridSize),this.ROAD_COLOR);const i=d.OFFSET,s=(this.gridSize-2*i)/6+i,r=(0,n.Triangle)(s,0,0,0,s,0,0,0,1);(0,n.translate)(r,0,0,1),f(t,e,r,this.BORDER_COLOR);const o=(0,n.Triangle)(s,0,0,s,s,0,0,0,1);(0,n.translate)(o,this.gridSize-s,0,1),f(t,e,o,this.BORDER_COLOR);const a=(0,n.Triangle)(s,s,0,0,s,0,0,0,1);(0,n.translate)(a,0,this.gridSize-s,1),f(t,e,a,this.BORDER_COLOR);const h=(0,n.Triangle)(-s,0,0,0,-s,0,0,0,1);(0,n.translate)(h,this.gridSize,this.gridSize,1),f(t,e,h,this.BORDER_COLOR)}}}e.Road=d,d.OFFSET=20,d.LINES=4;class u{constructor(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n,this.r=t<0?0:t>255?255:t,this.g=e<0?0:e>255?255:e,this.b=i<0?0:i>255?255:i}static RandomColor(){return new u(255*Math.random(),255*Math.random(),255*Math.random(),255)}}function f(t,e,i,n){const s=e.nextIndex;for(let t=0;t<i.indexes.length;t+=3)e.write3Uint16(i.indexes[t+0]+s,i.indexes[t+1]+s,i.indexes[t+2]+s);for(let e=0;e<i.positions.length;e+=3){t.write3Float32(i.positions[e+0],i.positions[e+1],i.positions[e+2]);const s=3===i.normals.length?0:e;t.write3Float32(i.normals[s+0],i.normals[s+1],i.normals[s+2]),t.write4Uint8(n.r,n.g,n.b,n.a)}}e.Color=u,e.PALLETS=[new u(238,238,238,255),new u(85,85,85,255),new u(135,136,132,255),new u(236,236,215,255),new u(209,221,226,255),new u(145,149,152,255),new u(67,151,74,255),new u(235,198,1,255),new u(199,93,111,255),new u(231,151,82,255),new u(74,113,167,255),new u(217,170,142,255),new u(120,149,109,255),new u(165,105,104,255),new u(228,203,169,255),new u(235,193,148,255),new u(183,65,76,255),new u(233,84,68,255)],e.calcHeight=function(t,e,i,n,s,r,o){const a=Math.pow(Math.sin(Math.PI*((t+.5)/i))*Math.sin(Math.PI*((e+.5)/n)),s);return Math.max(Math.min(r,r*a),o)}}},e={};!function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}(607)})();